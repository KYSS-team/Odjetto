# Telegram-бот для корпоративных обедов

Бот помогает автоматизировать оформление корпоративных обедов:
он выдаёт одноразовые токены сотрудникам, принимает заказы из подключённых ресторанов и присылает менеджеру ежедневные XLS-отчёты.

---

## Возможности

* Авторизация сотрудников по Telegram ID и одноразовым кодам приглашения, выданным менеджером.
* Панель менеджера: управление сотрудниками, их статусами и дневным лимитом средств.
* Загрузка ресторанов и меню, выбор офиса с автоподстановкой ранее использованных значений.
* Заказ обедов на текущую неделю с учётом:

  * дедлайна 12:00,
  * дневного лимита (по умолчанию 400 ₽),
  * запрета повторного заказа на одну и ту же дату.
* Возможность изменять заказ до 12:00 дня выдачи.
* Автоматическое предложение пополнить баланс при превышении лимита, уведомления о возврате лишних пополнений при изменении заказа.
* Ежедневная отправка XLS-отчётов по ресторанам менеджеру в заданное время.

---

## Стек

* [Aiogram](https://docs.aiogram.dev/) — работа с Telegram Bot API.
* [SQLAlchemy](https://www.sqlalchemy.org/) + SQLite — хранение пользователей, меню и заказов.
* [APScheduler](https://apscheduler.readthedocs.io/) — планирование отправки отчётов.
* [pandas](https://pandas.pydata.org/) — генерация XLS-файлов.

---

## Установка

1. Клонируйте репозиторий и перейдите в директорию проекта.
2. Создайте виртуальное окружение (по желанию) и установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```

---

## Настройка

Создайте файл `.env` (можно скопировать из `.env.example`) и укажите значения переменных окружения:

* `BOT_TOKEN` — токен Telegram-бота (обязателен).
* `ADMIN_PASSWORD` — пароль менеджера (по умолчанию `admin`).
* `REPORT_HOUR` и `REPORT_MINUTE` — время ежедневной отправки отчётов.
* `DB_NAME` — имя файла базы данных (по умолчанию SQLite-файл).
* `DEFAULT_LIMIT` — базовый дневной лимит для сотрудников.
* `ORDER_DEADLINE_HOUR` — час дедлайна для оформления/изменения заказов (по умолчанию 12).

При первом запуске автоматически создаётся база данных и устанавливается базовый дневной лимит.

---

## Запуск

### Через Docker

```bash
docker-compose up -d
```

Просмотр логов:

```bash
docker-compose logs -f
```

### Без Docker

```bash
pip install -r requirements.txt
python main.py
```

---

## Структура проекта

* `main.py` — точка входа: инициализация БД, запуск бота и планировщика отчётов.
* `handlers_auth.py` — авторизация и выбор интерфейса (сотрудник / менеджер).
* `handlers_manager.py` — управление сотрудниками, меню и дневными лимитами.
* `handlers_orders.py` — оформление и редактирование заказов сотрудниками.
* `reports.py` — генерация и отправка ежедневных XLS-отчётов по ресторанам.
* `states.py` — определения FSM-состояний для диалогов.

---

## Как начать работу

1. Менеджер входит в бота, используя `ADMIN_PASSWORD`, и попадает в панель управления.
2. В разделе «Управление сотрудниками» создаются сотрудники — бот выдаёт одноразовые коды приглашения.
3. В разделе «Меню/рестораны» добавляются рестораны и блюда.
4. Сотрудники:

   * запускают бота,
   * вводят одноразовый код приглашения,
   * выбирают дату, ресторан и блюда,
   * подтверждают заказ.
5. В заданное время менеджер получает XLS-отчёты по каждому ресторану в Telegram.

---

## Ссылка на бота

[https://t.me/odjetto_lunch_bot](https://t.me/odjetto_lunch_bot)
